<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Analyzing Categorical Data in R: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Analyzing Categorical Data in R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Analyzing Categorical Data in R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Analyzing Categorical Data in R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction to Categorical Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-effect-size.html">2. Quantifying association</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-visualization.html">3. Visualizing categorical data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-distributions.html">4. Sampling schemes and probabilities</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-chisquare-test.html">5. The Chi-Square test</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-power.html">6. Categorical data and statistical power</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-biology.html">7. Complications with biological data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-introduction"><p>Content from <a href="01-introduction.html">Introduction to Categorical Data</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/01-introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is categorical data and how is it usually represented?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Introduce the contingency table.</li>
<li>Learn to set up a contingency table in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>In biological experiments, we often compare what categories
observations fall into. For example, we might look at cells in
microscopy images and categorize them by the cell cycle, or by whether
they carry a certain marker. We could categorize individuals (animals of
humans) by whether they received a treatment in an experimental set-up,
or by sex.</p>
<p>In this lesson, you’ll learn</p>
<ul>
<li>how to handle data sets containing categorical data in R,<br>
</li>
<li>how to visualize categorical data,<br>
</li>
<li>how to calculate effect sizes,</li>
<li>how to test for a difference in proportions, and</li>
<li>what to watch out for when applying these methods to biological
data.</li>
</ul></section><section><h2 class="section-heading" id="contingency-tables">Contingency tables<a class="anchor" aria-label="anchor" href="#contingency-tables"></a>
</h2>
<hr class="half-width">
<p>Let’s start by looking at how categorical data is usually presented
to us.<br>
The most common format to communicate categorical data is by using a
<em>contingency table</em>. The following example describes an
experiment that aims at finding out whether exposure to a chemical in
question increases the risk of getting a certain disease. In the
experiment, 200 mice were either exposed to the chemical (N=100) or not
(N=100). After 4 weeks, the mice were tested for whether they had
developed the disease. In the non-exposed group, 4 mice had the disease,
and within the exposed group, 10 mice developed teh disease. This
information can be displayed as follows:</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">diseased</th>
<th align="center">healthy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">non-exposed</td>
<td align="center">4</td>
<td align="center">96</td>
</tr>
<tr class="even">
<td align="left">exposed</td>
<td align="center">10</td>
<td align="center">90</td>
</tr>
</tbody>
</table>
<p>Each mouse either was either exposed, or not. So
<code>exposure</code> is a categorical variable with two levels,
<code>exposed</code> and <code>non_exposed</code>. Similarly, we have a
variable which we might call <code>outcome</code>, with the categories
<code>healthy</code> and <code>diseased</code>.</p>
<p>The above contingency is a so-called 2x2 table, because it has two
rows and two columns. There are also variables with more than two
categories, which lead to larger tables.</p>
<p>In a contingency table, the rows and columns specify which categories
the two variables can take. The cells of the table represent the
possible combinations of the variable (for example <code>healthy</code>
and <code>exposed</code> is a possible combination), and the cell gives
the count how many times this combination was observed in the study or
experiment at hand.</p>
</section><section><h2 class="section-heading" id="some-terminology">Some terminology<a class="anchor" aria-label="anchor" href="#some-terminology"></a>
</h2>
<hr class="half-width">
<p>If we have a 2x2 table, then there are four squares with numbers in
them, which we refer to as the <strong>cells</strong> of the
table.<br>
Each cell contains a <strong>count</strong>, which we call <span class="math inline">\(n\)</span>, and we index it by the rows and
columns of that table. So the count in row 1 and column 2 will be called
<span class="math inline">\(n_{12}\)</span>.<br>
Sometimes we also look at row totals or column totals, and in this
lesson we use a dot (<span class="math inline">\(\cdot\)</span>) to
indicate when a row or column is summed over). The total counts in row
2, for example would be referred to as <span class="math inline">\(n_{2\cdot}\)</span>.</p>
<figure><img src="fig/terminology.png" width="300" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="contingency-tables-in-r">Contingency tables in R<a class="anchor" aria-label="anchor" href="#contingency-tables-in-r"></a>
</h2>
<hr class="half-width">
<p>Let’s suppose you have some observations, and you want to code them
up in a contingency table in R. For most of the analysis that we’ll see
in this lesson, it’s most useful to store the data in a matrix.</p>
<p>One way of constructing a matrix is by using the function
<code>rbind</code>, which “binds rows”: It takes vectors as arguments,
and stacks them as the rows of a matrix.</p>
<p>For the above table, the function call looks like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">96</span><span class="op">)</span>,</span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mytable</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]    4   96
[2,]   10   90</code></pre>
</div>
<p>Now, to remember which cell represents which observations, I find it
useful to name the rows and columns:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rownames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"non-exposed"</span>,<span class="st">"exposed"</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"diseased"</span>, <span class="st">"healthy"</span><span class="op">)</span></span>
<span><span class="va">mytable</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            diseased healthy
non-exposed        4      96
exposed           10      90</code></pre>
</div>
<p>Later in this lesson, we’ll also see how to tabulate observations
from data frames, and how to turn contingency tables into a tidy format
for modeling. But first, let’s get started with analyzing the table.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-effect-size"><p>Content from <a href="02-effect-size.html">Quantifying association</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/02-effect-size.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>
</li></ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>
</li></ul>
</div>
</div>
</div>
</div>
</div>
<p>Here’s the table again:</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">diseased</th>
<th align="center">healthy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">not exposed</td>
<td align="center">4</td>
<td align="center">96</td>
</tr>
<tr class="even">
<td align="left">exposed</td>
<td align="center">10</td>
<td align="center">90</td>
</tr>
</tbody>
</table>
<p>What we probably want to find out in a study as described in <a href="01-introduction.html">the previous episode</a>, is whether the
chemical has an effect on the risk for getting the disease. We could
also say, that we’d like to know whether the variables
<code>outcome</code> and <code>exposure</code> are <em>associated</em>.
Yet another way to express this question in quantitative terms is asking
whether the proportions of diseased mice are the same for exposed and
non-exposed mice.</p>
<p>So, it’s rather obvious that the proportions differ between the two
test groups <em>in this specific sample</em>:</p>
<ul>
<li>
<span class="math inline">\(4/100 = 4\%\)</span> in the non-exposed
group</li>
<li>
<span class="math inline">\(10/100 = 10\%\)</span> in the exposed
group.</li>
</ul>
<p>But since sampling includes randomness, it could be that the
difference is just by chance. Later in this lesson we’ll learn how to
test whether the difference in proportions is significance, by asking
how likely it is to see this difference just by chance, given the number
of test mice at hand.</p>
<p>For now, we’ll start by quantifying the effect that we observe in
this sample. There are different options to express the effect of the
exposure from this sample. After all we’re summarizing 4 counts into one
value, and there are more than one way of doing so.</p>
<section><h2 class="section-heading" id="measures-for-association">Measures for association<a class="anchor" aria-label="anchor" href="#measures-for-association"></a>
</h2>
<hr class="half-width">
<p><strong>Difference in proportions</strong>: The difference in
proportions is the most intuitive way of summarizing the contingency
table. We subtract the proportion of diseased mice in one group from the
proportion in the other. In our example</p>
<p><span class="math display">\[ D = \hat{P}(\text{disease}|E) -
\hat{P}(\text{disease} | N) = 0.06\]</span> In the formula above, we
subtract two conditional probabilities from each other. The notation
<span class="math inline">\(P(\text{event} | \text{condition})\)</span>
describes the probability of an event, <em>given</em> a condition. I use
<span class="math inline">\(N\)</span> and <span class="math inline">\(E\)</span> for describing the non-exposed and
exposed group, respectively. So <span class="math inline">\(P(\text{disease}|N)\)</span> is the probability of
getting the disease, given that a mouse belongs to the non-exposed
group.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Why the hat? Well, we’d sure like to learn something about the true
probabilities of getting the disease under some condition, but in fact
we only have a sample of 200 mice, which means the proportions don’t
correspond to the <em>true</em> probabilities, generalized over all mice
in the world. The notation <span class="math inline">\(\hat{P}\)</span>
acknowledges the fact that the sample proportions are our current best
<em>estimate</em> for the true probabilities.</p>
</div>
</div>
</div>
<p><strong>Relative risk:</strong> You may have noticed a problem about
the difference in proportion: It depends on how high the prevalence of
the disease is in the first place. For a disease with a very low
prevalence, we might see a difference between 8/1000 and 4/1000 test
subjects of the exposed and non-exposed group, which is only <span class="math inline">\(0.4\%\)</span>. But in relative terms, the
prevalence is twice as high in the exposed group compared to the
non-exposed group.</p>
<p>We can account for that by reporting the ratio between the
proportions in both groups:</p>
<p><span class="math display">\[RR = \frac{\hat{P}(\text{disease} |
E)}{\hat{P}(\text{disease} | N)} = 2.5 \]</span></p>
<p>The result <span class="math inline">\(RR=2.5\)</span> tells you that
the proportion of mice who developed the disease was <span class="math inline">\(2.5\)</span> times higher in the exposed group
than in the non-exposed group.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The relative risk has its origin in epidemiology, which means that
the name is meaningful in many clinical settings, but not necessarily in
with regard to every wet lab experiment. The important part here is to
first phrase the research question carefully, and then think about which
measure can be helpful in answering it. If the <span class="math inline">\(RR\)</span> is useful in your case, but the name
doesn’t make sense regarding your data, you can still use the measure
and think about a more useful terminology.</p>
</div>
</div>
</div>
<p><strong>Odds ratio:</strong> Often, the association between two
variables (in this case: disease and exposure) is also expressed in
terms of odds ratios. If a disease has the probability of <span class="math inline">\(p=0.1\)</span> of occurring in a mouse within a
given time, then the <em>odds</em> of getting the disease is <span class="math inline">\(\frac{p}{1-p}=\frac{0.1}{0.9}=0.11\)</span>. The
<em>odds ratio</em> compares the odds of getting the disease between two
conditions. In our example the odds ratio is</p>
<p><span class="math display">\[OR = \frac{\hat{P}(\text{disease}|E) /
(1 - \hat{P}(\text{disease}|E)) }{\hat{P}(\text{disease}|N) / (1 -
\hat{P}(\text{disease}|N))} \approx 2.7\]</span></p>
<p>We say that the odds for getting the disease is 2.7 higher in the
exposed group compare to the non-exposed group. For calculating the
sample odds ratio, you can use the following simple formula:</p>
<p><span class="math display">\[ OR = \frac{n_{1,1} / n_{1,2}}{n_{2,1} /
n_{2,2}}\]</span></p>
<p>Admittedly, the odds ratio is not a very intuitive measure for
association, but it has some useful mathematical properties (which won’t
concern us in this lesson). The odds ratio is</p>
<p><span class="math display">\[OR =
  \begin{cases}
    &gt;1       &amp; \quad \text{if there is a positive association}\\
    \,1     &amp; \quad \text{if there is no assocation}\\
    &lt;1    &amp; \quad \text{if there is a negative association}
  \end{cases}\]</span></p>
<p>Note that the <span class="math inline">\(OR\)</span> depends on how
you order your table.</p>
<p><strong>Log odds ratio:</strong> The log odds ratio is simply the
logarithm of the odds ratio, <span class="math inline">\(\log(OR)\)</span>. One nice thing about this value
is that it’s zero when there’s no association between the two
variables.</p>
<p><span class="math display">\[\log OR =
  \begin{cases}
    &gt;0       &amp; \quad \text{if there is a positive association}\\
    \,0     &amp; \quad \text{there is no association}\\
    &lt;0    &amp; \quad \text{there is a negative association}
  \end{cases}\]</span></p>
<p>This scale is useful for plotting data, because it’s good at
resolving strong negative associations (for example, if a treatment
<em>decreases</em> the risk for disease), which would be very small
numbers when expressed as relative risk, or odds ratios.</p>
<p>Knowing about log odds and log odds ratios is also useful for
interpreting some statistical models (for example Poisson GLM, or
logistic models) where the model parameters are expressed in terms of
log odds.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Consider the following data: <img src="fig/smoking_table.png" alt="Contingency table with numbers of lung cancer cases for smokers and non-smokers in a case control study." width="400" class="figure"></p>
<p>The above table comes from one of the first studies of the link
between lung cancer and smoking, by Richard Doll and A. Bradford Hill.
In 20 hospitals in London, UK, patients admitted with lung cancer in the
previous year were queried about their smoking behavior. For each
patient admitted, researchers studied the smoking behavior of a
non-cancer control patient at the same hospital of the same sex and
within the same 5-year grouping on age. A smoker was defined as a person
who had smoked at least one cigarette a day for at least a year.</p>
<ol style="list-style-type: decimal">
<li>Construct a table that represents this study in R.</li>
<li>Calculate a measure for association that you find useful in this
scenario.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Construct a contingency table:</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">688</span>, <span class="fl">650</span><span class="op">)</span>,</span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">59</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"controls"</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Since this is a case control study, comparing the proportions of
cancer patients between smokers and non-smokers makes no sense. They
don’t reflect the true probabilities of getting cancer, because by
design the same number of cancer and no cancer subjects were included in
the study. Instead, you can compare the proportions of smokers between
the groups:</li>
</ol>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. difference in proportions of smokers between cases and controls</span></span>
<span><span class="fl">688</span><span class="op">/</span><span class="op">(</span><span class="fl">21</span><span class="op">+</span><span class="fl">688</span><span class="op">)</span> <span class="op">-</span> <span class="fl">650</span><span class="op">/</span><span class="op">(</span><span class="fl">59</span><span class="op">+</span><span class="fl">650</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.05359661</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ratio in proportions of smokers between cases and controls</span></span>
<span><span class="op">(</span><span class="fl">688</span> <span class="op">/</span> <span class="op">(</span><span class="fl">21</span><span class="op">+</span><span class="fl">688</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">650</span> <span class="op">/</span> <span class="op">(</span><span class="fl">59</span><span class="op">+</span><span class="fl">650</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.058462</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --&gt; The proportion of smokers was 1.05 times higher for the cases</span></span>
<span></span>
<span><span class="co"># odds ratio</span></span>
<span><span class="op">(</span><span class="fl">688</span> <span class="op">/</span> <span class="fl">21</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">650</span><span class="op">/</span><span class="fl">59</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.973773</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --&gt; The odds for having smoked was 3 times higher in the cases group</span></span>
<span></span>
<span><span class="co"># log odds ratio</span></span>
<span><span class="fu">log</span><span class="op">(</span><span class="op">(</span><span class="fl">688</span> <span class="op">/</span> <span class="fl">21</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">650</span><span class="op">/</span><span class="fl">59</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.089831</code></pre>
</div>
</div>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-visualization"><p>Content from <a href="03-visualization.html">Visualizing categorical data</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-visualization.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I visualize categorical data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn to make a mosaic plot in base R and using
<code>ggplot2</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">96</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"not exposed"</span>,<span class="st">"exposed"</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"diseased"</span>, <span class="st">"healthy"</span><span class="op">)</span></span></code></pre>
</div>
<p>You now know how to calculate a measure for association from your
table - great! But so far, we’ve only looked at numbers, and you’ve also
learned that you should also visualize your data. Yes, even if it’s only
4 data points!</p>
<section><h2 class="section-heading" id="using-base-r">Using base R<a class="anchor" aria-label="anchor" href="#using-base-r"></a>
</h2>
<hr class="half-width">
<p>There is a very simple way to do this using base R:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mosaicplot</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/03-visualization-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure">
The <strong>mosaic plot</strong> consists of rectangles representing the
contingency table’s cells. The areas of the rectangles are proportional
to the respective cells’ count, making it easier for the human eye to
compare the proportions.</p>
<p>Note that the above mosaicplot is arranged such that the rectangles
of one column are neatly stacked on top of each other. At the same time,
it has flipped the table such that the rows of our matrix have become
the columns and <em>vice versa</em>.</p>
<p>This might not always be how you want your plot to look. For example,
consider the smokers example from <a href="02-effect-size.html">the
previous episode</a>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smokers</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">688</span>, <span class="fl">650</span><span class="op">)</span>,</span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">59</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">smokers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">smokers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"controls"</span><span class="op">)</span></span></code></pre>
</div>
<p>If we apply the <code>mosaicplot</code> here, it’ll look like
this:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mosaicplot</span><span class="op">(</span><span class="va">smokers</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/03-visualization-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure">
Using the argument <code>sort</code>, you can determine how the
rectangles are aligned. You can align them by rows as follows:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mosaicplot</span><span class="op">(</span><span class="va">smokers</span>,</span>
<span>           sort <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/03-visualization-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure">
Alternatively, you can run the plotting function on the
<em>transposed</em> contingency table:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mosaicplot</span><span class="op">(</span><span class="fu">t</span><span class="op">(</span><span class="va">smokers</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/03-visualization-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="using-ggplot2">Using <code>ggplot2</code>
<a class="anchor" aria-label="anchor" href="#using-ggplot2"></a>
</h2>
<hr class="half-width">
<p>We recommend using the <code>tidyverse</code> for data analysis in
general, and in particular <code>ggplot2</code> for plotting. The above
function is perfect for getting a quick overview on the data. For
creating high-quality, customized graphics, <code>ggplot2</code> is
usually the better choice.</p>
<p>This gives us a great opportunity to talk about tidy data: In a tidy
table</p>
<ul>
<li>each variable is a column and</li>
<li>each observation is a row.</li>
</ul>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>What would the mice table look like in tidy format?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>It would have three columns, according to the variables:
<code>exposure</code> (exposed or not), <code>outcome</code> (diseased
or healthy), and <code>count</code>.</p>
</div>
</div>
</div>
</div>
<p>Let’s code up the table in tidy format:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  exposure <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"no"</span><span class="op">)</span>,</span>
<span>  outcome <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"diseased"</span>, <span class="st">"healthy"</span>, <span class="st">"diseased"</span>, <span class="st">"healthy"</span><span class="op">)</span>,</span>
<span>  count <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">90</span>, <span class="fl">4</span>, <span class="fl">96</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mice</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  exposure  outcome count
1      yes diseased    10
2      yes  healthy    90
3       no diseased     4
4       no  healthy    96</code></pre>
</div>
<p>This tidy table can be the input for the <code>ggplot</code>
function. There are multiple ways and possible designs for mosaic plots
using <code>ggplot2</code>. We’ll demonstrate one here:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="va">mice</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sumcount <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">exposure</span>, y <span class="op">=</span> <span class="va">count</span>, fill<span class="op">=</span><span class="va">outcome</span>, width<span class="op">=</span><span class="va">sumcount</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">exposure</span>, scales <span class="op">=</span> <span class="st">"free_x"</span>, space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/03-visualization-rendered-tidy-mosaic-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The above code is borrowed from <a href="https://stackoverflow.com/questions/19233365/how-to-create-a-marimekko-mosaic-plot-in-ggplot2" class="external-link">this
post</a>.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The argument <code>width=sumcount</code> adjusts the width of the
bars according to the sum of counts per group (exposed / not exposed).
Since both groups have the same size in the above example, it doesn’t
actually have an effect here. It will make a difference once the groups
differ in size.</p>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-04-distributions"><p>Content from <a href="04-distributions.html">Sampling schemes and probabilities</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/04-distributions.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Question 1</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the how counts are generated.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Where do the counts in the contingency table come from? Answering
this question is an important part of understanding how we expect them
to behave in scenarios where two variables are independent or
associated.</p>
<p>Let’s switch to a different toy example: We have a contingency table
with frogs, which can either be male or female, and they can be either
light or dark green.</p>
<figure><img src="fig/frog_counts.png" alt="contingency table with images of male/female and light/dark frogs" width="400" class="figure mx-auto d-block"></figure><p>To fill this table with counts, we can imagine different study
designs that correspond to different sampling schemes.</p>
<section><h2 class="section-heading" id="sampling-schemes">Sampling schemes<a class="anchor" aria-label="anchor" href="#sampling-schemes"></a>
</h2>
<hr class="half-width">
<p><strong>1. Poisson sampling:</strong> Frogs of both sexes and colors
could be collected for a fixed period of time, let’s say 10 minutes.
They are then sorted into the four categories (male-light, male-dark,
female-light, and female-dark).</p>
<figure><img src="fig/contingency_poisson_sampling.png" alt="binomial sampling scheme with frogs" width="500" class="figure mx-auto d-block"></figure><p>We could describe this process as Poisson sampling, where each
category has its own Poisson rate <span class="math inline">\(\lambda_{r,c}\)</span>. We also know that the
Poisson distribution is an approximation of binomial distribution, with
a rate of</p>
<p><span class="math display">\[\lambda_{r,c} = n *
p_{r,c},\]</span></p>
<p>where in this example, <span class="math inline">\(n\)</span> is the
number of frogs we usually see during the 10 min, and <span class="math inline">\(p_{r,c}\)</span> is the <em>success
probability</em> of a frog belonging to the respective category. The
rate <span class="math inline">\(\lambda_{rc}\)</span> is the expected
count for the cell in row <span class="math inline">\(r\)</span> and
column <span class="math inline">\(c\)</span>.</p>
<p><strong>2. Binomial sampling:</strong> Maybe there are many more
female than male frogs in the lake, and therefore the researchers
decided to balance the study by catching 50 male and 50 female frogs,
and comparing the proportions or light and dark between those.</p>
<figure><img src="fig/contingency_binomial_sampling.png" width="400" class="figure mx-auto d-block"></figure><p>In this case, we could describe the scenario as two binomial sampling
processes. In one of them, we have</p>
<ul>
<li>a fixed number of <span class="math inline">\(n_{1\cdot}\)</span>
female frogs, and a probability of <span class="math inline">\(p_{xx}\)</span> for each of them of being
light.</li>
<li>a fixed number of <span class="math inline">\(n_{2\cdot}\)</span>
male frogs, and a probability of <span class="math inline">\(p_{x}\)</span> for each of them of being
light.</li>
</ul>
<p>The expected count for each cell is <span class="math inline">\(p_{xx}n_{1\cdot}\)</span>.</p>
<p><strong>Multinomial sampling:</strong> One could also set up a study
in which the total number of frogs is fixed from the beginning, for
example the researchers could fill a net with 100 frogs and then sort
them into the four categories.</p>
<figure><img src="fig/contingency_multinomial_sampling.png" width="500" class="figure mx-auto d-block"></figure><p>This would be described as a multinomial sampling. There is a fixed
number of <span class="math inline">\(n_{\cdot,\cdot}\)</span> frogs
(=events), and there are four different outcomes for each event, each
with its own probability <span class="math inline">\(p_{r,c}\)</span>.
The expected count in each cell is thus <span class="math inline">\(n_{\cdot\cdot}p_{rc}\)</span>.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>If the terms I’m using above sound unfamiliar to you, please revisit
the <a href="https://sarahkaspar.github.io/biostatistics-course/" class="external-link">lesson
on statistical distributions</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="expected-counts">Expected counts<a class="anchor" aria-label="anchor" href="#expected-counts"></a>
</h2>
<hr class="half-width">
<p>You probably noticed that, irrespective of the sampling scheme,
i.e. <em>the data generating process</em>, the expected count for each
cell is some multiplication of a probability <span class="math inline">\(p\)</span> and a number of observations <span class="math inline">\(n\)</span>. If we collect data, we can control the
sampling scheme, but, of course, we don’t know the true <span class="math inline">\(p\)</span>s. If we knew them, we could answer
right away whether the proportions of dark frogs are different among
female and male frogs.</p>
<p>However, we can make a prediction about how we expect the
probabilities – and thus counts – to behave in case the proportions of
dark frogs are the same for both sexes. For this, we need an excursion
to probability theory.</p>
</section><section><h2 class="section-heading" id="probability-rule-for-independence">Probability rule for independence<a class="anchor" aria-label="anchor" href="#probability-rule-for-independence"></a>
</h2>
<hr class="half-width">
<p>When we are asking whether the proportions of dark frogs are the same
for both sexes, we can rephrase this question and ask: Are the sex and
the color independent of each other.</p>
<p>Let’s look at two examples, one for independent and one for dependent
probabilities.</p>
<p>As an example for <strong>independent events</strong>, consider two
coins that are being flipped. If no black magic is at work, then the
outcome of the first coin flip shouldn’t influence the outcome of the
second. The probability of seeing two times head up is therefore</p>
<p><span class="math display">\[P(\text{head},\text{head}) =
\overbrace{P(\text{head})}^{\text{first coin}} \cdot \overbrace{
P(\text{head})}^{\text{second coin}} = \frac{1}{2} \cdot \frac{1}{2} =
\frac{1}{4} \]</span></p>
<p>More generally, we can say that if two events <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are independent, then the probability
of them occuring together is</p>
<p><span class="math display">\[P(A,B) = P(A) \cdot P(B)\]</span></p>
<p>This probability rule doesn’t hold when two outcomes are
<strong>associated</strong> with each other. For example, we know that
hair and eye color are associated. The probability of having blond hair
and blue eyes can <em>not</em> be calculated by multiplying the
individual probabilities. Why? Because once we know that someone has
blond hair, the probability of also observing blue eyes is much higher
than the <em>marginal</em> probability of having blue eyes. The marginal
probability is the probability of having blue eyes, averaged over all
people of all hair colors. We’d have to calculate</p>
<p><span class="math display">\[P(\text{blond},\text{blue}) =
P(\text{blond}) \cdot
\overbrace{P(\text{blue|blond})}^{\text{conditional
probability}},\]</span> where <span class="math inline">\(P(\text{blond})\)</span> is the overall (marginal)
probability of having blond hair, and <span class="math inline">\(P(\text{blue|blond})\)</span> is the
<em>conditional probability</em> of having blue eyes, for those that
have blond hair.</p>
<p>The important part for us to move on with the contingency table
analysis is that, when two events or variables <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are associated, then</p>
<p><span class="math display">\[P(A,B) \neq P(A) \cdot
P(B).\]</span></p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05-chisquare-test"><p>Content from <a href="05-chisquare-test.html">The Chi-Square test</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/05-chisquare-test.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the null and alternative hypothesis of the chi-square
test?</li>
<li>What are the expected counts under the null hypothesis?</li>
<li>What is the test statistic for the chi-square test?</li>
<li>How can I run the chi-square test in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the principle behind the chisquare test.</li>
<li>Be able to apply the chisquare test in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="a-hypothesis-test-for-independence">A hypothesis test for independence<a class="anchor" aria-label="anchor" href="#a-hypothesis-test-for-independence"></a>
</h2>
<hr class="half-width">
<p>So far, we have learned that</p>
<ul>
<li>in a <span class="math inline">\(2\times 2\)</span> contingency
table, we tabulate the counts according to two variables.</li>
<li>We are usually interested in whether the two variables are
associated.</li>
<li>If the variables are associated, they should not follow the
probability rules for independence.</li>
</ul>
<p>If we’d like to set up a hypothesis test for whether the two
variables are associated, then we have to formulate a null hypothesis,
and then calculate the probability of the observed counts under this
hypothesis.</p>
<p>Let’s start with the null and alternative hypothesis. The
<strong>null hypothesis</strong> is that the two variables are
<strong>independent</strong>.<br>
If we can reject the null hypothesis, we will take on the
<strong>alternative hypothesis</strong> is that the two variables are
<strong>associated</strong>.</p>
</section><section><h2 class="section-heading" id="expected-counts-under-then-null-hypothesis">Expected counts under then null hypothesis<a class="anchor" aria-label="anchor" href="#expected-counts-under-then-null-hypothesis"></a>
</h2>
<hr class="half-width">
<p>In the chi-square test, which tests the above hypothesis, we start by
calculating the expected counts under the null hypothesis, and then
check how far the actual data are away from the expectation.</p>
<p>For this, we need to calculate the <em>marginal frequencies</em> of
the outcomes of each variable. Remember, the marginal frequencies could
also be translated as the <em>overall</em> frequency of this
outcome.</p>
<figure><img src="fig/marginal-probabilities.png" width="600" class="figure mx-auto d-block"></figure><p>The marginal frequencies are our estimate for the true <em>marginal
probabilities</em>, which is why they are noted as <span class="math inline">\(\hat{P}\)</span> (p hat). Remember that the hat
indicates that the quantity below the hat is an estimate.</p>
<p>In the exposure/disease example, we can calculate the estimate for
the marginal disease probability as</p>
<p><span class="math display">\[\hat{P}(\text{disease}) =
\frac{n_{11}+n_{21}}{n_{\cdot\cdot}}.\]</span></p>
<p>This means we take the total number of diseased mice in the
experiment (those that have been exposed, and those that haven’t been)
and divide it by the total number of mice in the experiment. In other
words, we calculate the proportion of mice with disease, ignoring that
some of them have been exposed to the chemical and others haven’t.</p>
<p>Likewise we can calculate the marginal proportion of exposed mice
as</p>
<p><span class="math display">\[\hat{P}(\text{exposed}) = \frac{n_{11} +
n_{12}}{n_{\cdot\cdot}},\]</span> meaning we divide the number of all
exposed mice (ignoring whether they contracted the disease) by the total
number of mice in the experiment.</p>
<p>Let’s add some numbers to this:</p>
<figure><img src="fig/marginal-probabilities-2.png" width="500" class="figure mx-auto d-block"></figure><p>In the above table, I’ve added the marginal totals on the sides (I
think that’s where the term “marginal” comes from). We see that, in
total, 100 out of the 200 mice were exposed to the chemical (by design
of the experiment), which gives a marginal proportion of <span class="math display">\[\hat{P}(\text{exposure})=\frac{100}{200}=0.5\]</span>
of exposed mice. On the other hand, ignoring exposure, 14 out the 200
mice caught the disease during the experiment, giving an estimated
marginal probability of</p>
<p><span class="math display">\[\hat{P}(\text{disease})=\frac{14}{200}=0.07.\]</span></p>
<p>Now, the key point is that we estimated the probabilities of exposure
and disease, while <em>ignoring</em> the respective other variable –
which is exactly what’s valid to do when the two variables are not
associated. So, assuming the null hypothesis is true and the variables
are in fact nor associated, we can use these estimated probabilities and
apply the probability rule for independence to calculate the estimated
counts under the null.</p>
<p>For example, the expected count for exposed, diseased mice is</p>
<p><span class="math display">\[E(n_{11}) = \hat{P}(\text{exposed})
\cdot \hat{P}(\text{disease}) \cdot n_{\cdot\cdot} = 0.5 \cdot 0.07
\cdot 200 = 7.\]</span></p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Can you calculate the expected count for non-exposed diseased mice
under the assumption of independence?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><span class="math display">\[E_{22} = \hat{P}(\text{non-exposed})
\cdot \hat{P}(\text{healthy}) \cdot n_{\cdot\cdot} = 0.5 \cdot 0.93
\cdot 200 = 93\]</span></p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="the-chi-square-statistic">The Chi-square statistic<a class="anchor" aria-label="anchor" href="#the-chi-square-statistic"></a>
</h2>
<hr class="half-width">
<p>If we have expected counts under the assumption of independence, the
natural thing to do is compare them with the <strong>actual</strong>
counts. For a hypothesis test, we’d like to have the probability of the
observed counts under the assumption of independence, which is one
value, while we have four counts. Therefore, in the chi-square test, the
discrepancy between observed and expected counts is summarized into one
<em>statistic</em> called <span class="math inline">\(\chi^2\)</span>
(chi square):</p>
<p><span class="math display">\[\chi^2 =
\sum_{ij}\frac{(O_{ij}-E_{ij})^2}{E_{ij}}\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are the row and column indices,</li>
<li>
<span class="math inline">\(O\)</span> is the observed count,
and</li>
<li>
<span class="math inline">\(E\)</span> is the expected count.</li>
</ul>
<p>The value <span class="math inline">\(\chi^2\)</span> is the sum of
squares of the differences between observed and expected counts,
normalized by the expected counts, and it <strong>quantifies the
deviation from independence</strong>.</p>
<p>Now we need the probability of the <span class="math inline">\(\chi^2\)</span> calculated from our data under the
assumption of independence. To find a <strong>null distribution</strong>
for <span class="math inline">\(\chi^2\)</span>, you could repeatedly
simulate data from a model in which the two variables are independent,
and then compare the observed value to the resulting distribution. Since
in the previous lessons, we haven’t yet learned how to do this, we’ll
stick with textbook knowledge for now:</p>
<p>The textbook tells us that the <em>test statistic</em> <span class="math inline">\(\chi^2\)</span> follows a so-called <span class="math inline">\(\chi^2\)</span> distribution (just like the
t-statistic follows a t-distribution) with <span class="math inline">\((r-1)\cdot(r-2)\)</span> degrees of freedom, where
<span class="math inline">\(r\)</span> and <span class="math inline">\(c\)</span> are the numbers of rows and columns in
the contingency table, respectively.</p>
</section><section><h2 class="section-heading" id="the-chi-square-test-in-r">The Chi-square test in R<a class="anchor" aria-label="anchor" href="#the-chi-square-test-in-r"></a>
</h2>
<hr class="half-width">
<p>Let’s look at some results in practice. The test itself is really
just one line of code.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">mytable</span>, correct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test

data:  mytable
X-squared = 2.765, df = 1, p-value = 0.09635</code></pre>
</div>
<p>The output is also rather compact. We learn that R has calculated a
value for <span class="math inline">\(\chi^2=2.765\)</span>.<br><code>df=1</code> tells us that it has compared this value to a <span class="math inline">\(\chi^2\)</span>-distribution with one degree of
freedom. <code>p-value = 0.09635</code> means that the probability of
observing a <span class="math inline">\(\chi^2\geq 2.765\)</span> is
around 10%.</p>
<p>We could also perform this calculation ourselves:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pchisq</span><span class="op">(</span><span class="fl">2.765</span>,df<span class="op">=</span><span class="fl">1</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.09634669</code></pre>
</div>
<p><strong>Conclusion:</strong> The difference in proportions of
diseased mice are not significantly different in the exposure and
no-exposure groups.</p>
<p>As a reminder: This doesn’t mean that exposure and disease are not
associated, but that the data doesn’t hold enough evidence for a
potential association, at a significance level of <span class="math inline">\(\alpha=0.05\)</span>.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>Look into the help for the <code>chisq.test</code> function. Why is
there no option to choose between a one-sided and a two-sided test?</p>
</div>
</div>
</div>
<div id="note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p>In the function call to <code>chisq.test</code>, we used the argument
<code>correct=FALSE</code>. This argument determines whether or not
<em>Yates continuity correction</em> is used. If you want to learn more
about it, have a look <a href="https://en.wikipedia.org/wiki/Yates%27s_correction_for_continuity" class="external-link">here</a>.
My suggested default is to not use it.</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Assign the output of the <code>chisq.test</code> function call to a
variable, and apply the <code>names</code> function on it. Can you look
at the expected counts for the exposure/disease table?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytest</span> <span class="op">&lt;-</span> <span class="fu">chisq.test</span><span class="op">(</span><span class="va">mytable</span>, correct <span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">mytest</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "statistic" "parameter" "p.value"   "method"    "data.name" "observed"
[7] "expected"  "residuals" "stdres"   </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytest</span><span class="op">$</span><span class="va">expected</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            diseased healthy
non-exposed        7      93
exposed            7      93</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="when-to-apply">When to apply<a class="anchor" aria-label="anchor" href="#when-to-apply"></a>
</h2>
<hr class="half-width">
<p>The <span class="math inline">\(\chi^2\)</span> test is applicable to
2-dimensional contingency tables for testing the hypothesis of
independence.</p>
<ul>
<li>It assumes that all observations are independent (one observation is
an event that leads to the count in one cell being increased by 1).</li>
<li>A rule of thumb is that the expected values of all cells in the
contingency table should be &gt;5 in at least 80% of the cells, and the
expected cells should not be &lt;1 in any of the cells. If this isn’t
the case, an alternative is Fisher’s exact test (see <a href="06-power.html">next episode</a>).</li>
</ul>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 --></section></section><section id="aio-06-power"><p>Content from <a href="06-power.html">Categorical data and statistical power</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-power.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What determines the power of a chi-square test?</li>
<li>Why is it difficult to determine significance for discrete
data?</li>
<li>What is the Fisher test and when should I use it?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Introduce Fisher’s exact test.</li>
<li>Explain difficulties with significance testing for discrete
p-values.</li>
<li>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="statistical-power">Statistical power<a class="anchor" aria-label="anchor" href="#statistical-power"></a>
</h2>
<hr class="half-width">
<p>Statistical power is the probability that an effect is detected as
significant with a given method, provided that the effect really
exists.</p>
<p>In the lesson on hypothesis testing, we learned that the power
depends on</p>
<ul>
<li>the size of the effect,</li>
<li>the significance level,</li>
<li>the method we choose for testing, and</li>
<li>the sample size.</li>
</ul>
<p>In this lesson’s example, the estimated association is not quite
small (<span class="math inline">\(6\%\)</span> difference in
proportions, or the risk for getting the disease is more than twice as
high for exposed mice), the significance level was the usual <span class="math inline">\(5\%\)</span>, and a sample size of 200 doesn’t
seem small, either. Still, the effect is not significant. Does this mean
that the <span class="math inline">\(\chi^2\)</span>-test is
useless?</p>
<p>They key here is the low overall probability of mice contracting the
disease. Even though there were 200 mice, only a total of 14 out of them
actually contracted the disease. And it’s this low number of cases that
limits the power of the study.</p>
<p>In fact, if there was a sample of 2000 mice, and only 14 of them
caught the disease, then the p-value would hardly change:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">996</span><span class="op">)</span>,</span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">990</span><span class="op">)</span><span class="op">)</span>,</span>
<span>correct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test

data:  rbind(c(4, 996), c(10, 990))
X-squared = 2.5896, df = 1, p-value = 0.1076</code></pre>
</div>
<p>Intuitively, we still have 14 cases, and the question is how we’d
expect them to distribute among the two groups (exposure and no
exposure) by chance.</p>
<p>Thus, the power of the study is limited by the lowest counts in the
table. We could also say that extreme frequencies (a low probability of
one outcome always corresponds to a high probability of the other
outcome) are unfavorable in terms of power. To overcome the problem of a
low number of cases, clinical studies are often conducted as
<strong>case-control studies</strong>. In those, the same number of
cases and controls are sampled by design. One can then compare the
occurrence of certain risk factors (e.g. smoking, exposure, …) between
the two groups.</p>
</section><section><h2 class="section-heading" id="the-fisher-test">The Fisher test<a class="anchor" aria-label="anchor" href="#the-fisher-test"></a>
</h2>
<hr class="half-width">
<p>There is another test, called <strong>Fisher test</strong>, which is
also used on contingency tables, and which tests exactly the same
hypothesis as the <span class="math inline">\(\chi^2\)</span> test. It
doesn’t sum up the differences between observed and expected counts, but
instead calculates the probability of the observed data using a
hypergeometric distribution. The hypergeometric distribution is similar
to the multinomial distribution (except that it assumes draws
<em>without</em> replacement) and gives exact probabilities for counts
to fall into different categories (in this case the cells of the table)
under the assumption of independence. See <a href="https://online.stat.psu.edu/stat504/lesson/4/4.5" class="external-link">here</a> for
more details on the Fisher test.</p>
<div id="apply-the-fisher-test" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="apply-the-fisher-test" class="callout-inner">
<h3 class="callout-title">Apply the Fisher test</h3>
<div class="callout-content">
<p>Consider the table we’ve been looking at throughout this lesson.</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">diseased</th>
<th align="center">healthy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">not exposed</td>
<td align="center">4</td>
<td align="center">96</td>
</tr>
<tr class="even">
<td align="left">exposed</td>
<td align="center">10</td>
<td align="center">90</td>
</tr>
</tbody>
</table>
<p>Look up the help for <code>fisher.test</code>. Can you apply this
test on the above data? How do you interpret the result? How does it
compare to the outcome of the <span class="math inline">\(\chi^2\)</span> test?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fisher.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">96</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Fisher's Exact Test for Count Data

data:  rbind(c(4, 96), c(10, 90))
p-value = 0.164
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
 0.08322597 1.36465456
sample estimates:
odds ratio
 0.3767541 </code></pre>
</div>
<p>The p-value for the Fisher test is higher than for the <span class="math inline">\(\chi^2\)</span> test (without correction), but
almost identical to the <span class="math inline">\(\chi^2\)</span> test
with Yates continuity correction (see below). The conclusion stays the
same: Not significant at <span class="math inline">\(\alpha=0.05\)</span>. The <code>fisher.test</code>
function also gives an odds ratio <span class="math inline">\(\approx
0.37\)</span>. The part that I don’t like about this output is that we
have to guess which odds are being compared. If you look up the <a href="02-effect-size.html#measures-for-association">measures for
association</a>, you’ll notice that the calculated odds ratio for the
same table was <span class="math inline">\(\approx 2.7\)</span>. There
we looked at the odds of getting the disease in case of exposure,
relative to non-exposure, because this seemed natural. In the
<code>fisher.test</code> function, the ratio was calculated the other
way round. We could change this by switching the rows of the table:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fisher.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span><span class="op">)</span>,<span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">96</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Fisher's Exact Test for Count Data

data:  rbind(c(10, 90), c(4, 96))
p-value = 0.164
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  0.7327862 12.0154803
sample estimates:
odds ratio
  2.654251 </code></pre>
</div>
<p>Alternatively, we can calculate the inverse of the result:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">/</span><span class="fl">0.3767</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.654632</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>If you do your research on which test to use (e.g. ask google),
you’ll stumble upon statements like “the Fisher test is more
conservative”, or “the <span class="math inline">\(\chi^2\)</span>-test
overestimates significance for small counts”. What does this mean? These
statements both concern errors in hypothesis testing: If the Fisher test
is conservative, this means that it is prone to failing to detect cases
where an effect exists, i.e. it has a low power. On the other hand, if
the <span class="math inline">\(\chi^2\)</span>-test overestimates
significance, then we have a problem with false positives.<br>
In the next sections, we’ll learn why p-values are a bit tricky to
interpret for categorical data, and how this leads to discussions on
when to use which test.</p>
</section><section><h2 class="section-heading" id="significance-for-discrete-data">Significance for discrete data<a class="anchor" aria-label="anchor" href="#significance-for-discrete-data"></a>
</h2>
<hr class="half-width">
<p>Let’s recap what it means to choose a significance level of <span class="math inline">\(\alpha=5\%\)</span>: We decide to reject the null
hypothesis if the probability of seeing the observed data under the null
is <span class="math inline">\(\leq5\%\)</span>.</p>
<p>For continuous probability distributions like the t-distribution used
in the t-test, this means that the probability of getting a p-value
<span class="math inline">\(&lt;0.05\)</span> is <span class="math inline">\(5\%\)</span>, the probability of getting a p-value
<span class="math inline">\(&lt;0.1\)</span> is <span class="math inline">\(10\%\)</span>, and so on. This is the definition
of the p-value.</p>
<p>So if you have <span class="math inline">\(1000\)</span> scenarios
where nothing is going on and calculate a p-value using a one-sample
t-test:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">1000</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pvals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">t.test</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, mu<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Then in roughly <span class="math inline">\(10\%\)</span> of the
cases, the p-value is below <span class="math inline">\(0.1\)</span>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">pvals</span> <span class="op">&lt;</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.111</code></pre>
</div>
<p>Then in roughly <span class="math inline">\(20\%\)</span> of the
cases, the p-value is below <span class="math inline">\(0.2\)</span>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">pvals</span> <span class="op">&lt;</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.218</code></pre>
</div>
<p>If you make a histogram of the p-values, it will be roughly
uniform:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.frame</span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">pvals</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/06-power-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Unfortunately, for discrete data, this is not actually the case.</p>
<p>The following simulation is an attempt to demonstrate this. Suppose
we test the association between the preferred animal of a person (we
give the choice between cat and dog), and their handedness. And let’s
say that being left-handed gives absolutely no information on whether a
person likes cats more than dogs, i.e. the null hypothesis of
independence is true. Further, we assume that the probability of being
left-handed is <span class="math inline">\(P(L)=0.1\)</span> and the
probability of preferring cats is <span class="math inline">\(P(C)=0.6\)</span>. The hypothetical experiment
will sample 50 left-handed and 50 right-handed persons, and ask them
about their preference for cats or dogs. With this information, we can
simulate such a study using <code>rbinom</code> for generating random
binomial numbers:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">cats_l</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">dogs_l</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_l</span></span>
<span><span class="va">cats_r</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">dogs_r</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_r</span></span>
<span></span>
<span><span class="va">simtable</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="va">cats_l</span>, <span class="va">dogs_l</span><span class="op">)</span>,</span>
<span>                  <span class="fu">c</span><span class="op">(</span><span class="va">cats_r</span>, <span class="va">dogs_r</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can also compute the p-value from this table:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">simtable</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test with Yates' continuity correction

data:  simtable
X-squared = 0.35651, df = 1, p-value = 0.5505</code></pre>
</div>
<p>To see how the p-values behave, let’s run 2000 such simulations and
report the p-value. For this, I use a for-loop around the above code. In
each iteration of the loop, a contingency table under always the same
assumptions is generated, and the p-value is stored in a variable calle
<code>p_vals</code>.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">N</span><span class="op">=</span><span class="fl">2000</span></span>
<span><span class="va">p_vals</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># as many iterations as p_vals is long</span></span>
<span>  <span class="va">cats_l</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="va">dogs_l</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_l</span></span>
<span>  <span class="va">cats_r</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="va">dogs_r</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_r</span></span>
<span>  </span>
<span>  <span class="va">p_vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">chisq.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="va">cats_l</span>, <span class="va">dogs_l</span><span class="op">)</span>,</span>
<span>                    <span class="fu">c</span><span class="op">(</span><span class="va">cats_r</span>, <span class="va">dogs_r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>As a result of the simulation, <code>p_vals</code> contains 2000
p-values under the assumption that the null hypothesis is true.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<p>What percentage of the p-values is smaller than <span class="math inline">\(0.05\)</span>?</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">p_vals</span><span class="op">&lt;</span><span class="fl">0.05</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.004515805</code></pre>
</div>
<p>We can also make a histogram of all the p-values in the
simulation:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.frame</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">p_vals</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/06-power-rendered-unnamed-chunk-15-1.png" style="display: block; margin: auto;" class="figure">
In theory, the histogram should show a uniform distribution (the
probability of getting a p-value <span class="math inline">\(&lt;0.05\)</span> is <span class="math inline">\(5\%\)</span>, the probability of getting a p-value
<span class="math inline">\(&lt;0.1\)</span> is <span class="math inline">\(10\%\)</span>, and so on…). But here, instead, the
p-values are <em>discrete</em>: They can only take certain values,
because there’s only a limited number of options how 25 observations can
fall into two categories (dogs/cats).</p>
<p>Since for small counts, the chances to get a p-value <span class="math inline">\(p&lt;0.05\)</span> are actually
<strong>below</strong> 5% – and this holds also for other values of
<span class="math inline">\(p\)</span> which are not exactly <span class="math inline">\(0.05\)</span> – we say that the Fisher test is
<strong>conservative</strong>. It means that interpreting the discrete
hypergeometric probabilities as continuous p-values will lead us to
overestimated p-values. This also holds true when the null hypothesis is
actually <em>false</em>, so we’re reducing our chances to run a
significant test, even if there’s something to detect.</p>
<p>For a more detailed explanation, see <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/0470114754" class="external-link">An
introduction to Categorical Data Analysis</a> by Alan Agresti.</p>
</section><section><h2 class="section-heading" id="now-what">Now what?<a class="anchor" aria-label="anchor" href="#now-what"></a>
</h2>
<hr class="half-width">
<p>The Fisher test is conservative, especially for low counts. The <span class="math inline">\(\chi^2\)</span>-test doesn’t have this problem,
but at the same time should not be applied to tables with low counts,
because it might produce <em>false positives</em> (see the <a href="05-chisquare-test.html#when-to-apply">rule of thumb</a>). So what
should we do? There is not one commonly accepted answer to this. Some
suggestions are:</p>
<ul>
<li>Use Fisher’s exact test and accept that it can be conservative. In
the end, low counts indicate a small amount of evidence anyways, and you
might need to collect more data to detect or confirm an effect.</li>
<li>In <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/0470114754" class="external-link">Agresti’s
book</a>, you’ll find mid p-values and similar methods that aim at
correcting the p-value for its discreteness.</li>
<li>You can use the <span class="math inline">\(\chi^2\)</span>-test in
conjunction with <a href="https://en.wikipedia.org/wiki/Yates%27s_correction_for_continuity" class="external-link">Yates
continuity correction</a>. It applies a correction on the <span class="math inline">\(\chi^2\)</span> statistic for tables with low
expected counts to avoid underestimating the p-value. This method is not
perfect either, and can lead to over-correcting.</li>
</ul>
<p>The important part is that you don’t choose the method based on the
p-value it produces for your specific data set. The worst thing you can
do is try 3 different methods, choose the one with the lowest p-value
and report this one. This is a form of p-value hacking called <em>method
hacking</em> and increases your chances to produce false positive
results. If your test comes out significant in only one of the tests you
tried, be honest and report all of them, or otherwise investigate
further, for example by collecting more data.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-07-biology"><p>Content from <a href="07-biology.html">Complications with biological data</a></p>
<hr>
<p>Last updated on 2025-03-04 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/07-biology.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>When are Fisher- and Chisquare test not applicable for biological
data?</li>
<li>What are alternative methods?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain overdispersion and how it can lead to false positives.<br>
</li>
<li>Explain random effects.</li>
<li>Name some alternative methods.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<hr class="half-width">
<p>The lesson has been using a very simple example to illustrate the
principles behind analyzing categorical data.</p>
<p>Of course, biological data are often more complex than can be
captured by a <span class="math inline">\(2\times2\)</span> table.</p>
<p>Some examples for this are:</p>
<ul>
<li>There are more than two categories per variable. For instance, 3
different treatments are applied on cultured cells, and individual cells
are subsequently categorized into 4 mutually exclusive phenotypes.</li>
<li>There are more than two variables. For instance, the above
experiments could have been carried out in three replicates, such that
replicate is the third variable. We are looking for an effect that is
consistent across replicates.</li>
</ul></section><section><h2 class="section-heading" id="larger-tables">Larger tables<a class="anchor" aria-label="anchor" href="#larger-tables"></a>
</h2>
<hr class="half-width">
<p>Let’s start with the first example, where 3 different treatments are
applied on cultured cells, and individual cells are subsequently
categorized into 4 mutually exclusive phenotypes. The resulting
contingency table could look like this:</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">round</th>
<th align="center">spiky</th>
<th align="center">stretched</th>
<th align="center">flat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">treatment 1</td>
<td align="center">5</td>
<td align="center">15</td>
<td align="center">30</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="left">treatment 2</td>
<td align="center">10</td>
<td align="center">37</td>
<td align="center">21</td>
<td align="center">29</td>
</tr>
<tr class="odd">
<td align="left">treatment 3</td>
<td align="center">1</td>
<td align="center">40</td>
<td align="center">0</td>
<td align="center">14</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="how-to-visualize-the-proportions">How to visualize the proportions?<a class="anchor" aria-label="anchor" href="#how-to-visualize-the-proportions"></a>
</h3>
<p>We can still use mosaic plots to visualize the proportions:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell_shapes</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">5</span>,<span class="fl">15</span>,<span class="fl">30</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">37</span>,<span class="fl">21</span>,<span class="fl">29</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">40</span>,<span class="fl">0</span>,<span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">cell_shapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"treatment 1"</span>,<span class="st">"treatment 2"</span>, <span class="st">"treatment 3"</span><span class="op">)</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">cell_shapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"round"</span>, <span class="st">"spiky"</span>, <span class="st">"stretched"</span>, <span class="st">"flat"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mosaicplot</span><span class="op">(</span><span class="va">cell_shapes</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/07-biology-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="for-the-brave" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="for-the-brave" class="callout-inner">
<h3 class="callout-title">For the brave</h3>
<div class="callout-content">
<p>Can you turn the <code>cell_shapes</code> table into tidy data, and
make a mosaic plot with <code>ggplot2</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The tricky part is data wrangling:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_shapes</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="va">cell_shapes</span>, treatment<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"treatment1"</span>, <span class="st">"traetment2"</span>,<span class="st">"treatment3"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"shape"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_shapes</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 12 × 3
   treatment  shape     count
   &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;
 1 treatment1 round         5
 2 treatment1 spiky        15
 3 treatment1 stretched    30
 4 treatment1 flat          3
 5 traetment2 round        10
 6 traetment2 spiky        37
 7 traetment2 stretched    21
 8 traetment2 flat         29
 9 treatment3 round         1
10 treatment3 spiky        40
11 treatment3 stretched     0
12 treatment3 flat         14</code></pre>
</div>
<p>For plotting, all you need to do is exchange the variable names from
the instructions in <a href="03-visualization.html#using-ggplot2">episode 3</a>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_shapes</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sumcount <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">treatment</span>, y <span class="op">=</span> <span class="va">count</span>, fill<span class="op">=</span><span class="va">shape</span>, width<span class="op">=</span><span class="va">sumcount</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">treatment</span>, scales <span class="op">=</span> <span class="st">"free_x"</span>, space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<p><img src="fig/07-biology-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure">
Looks much nicer, doesn’t it?</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="what-are-suitable-measures-for-association">What are suitable measures for association?<a class="anchor" aria-label="anchor" href="#what-are-suitable-measures-for-association"></a>
</h3>
<p>All the <a href="02-effect-size.html">measures</a> you learned about
are require a <span class="math inline">\(2\times2\)</span> table. The
good news is that you can subset or summarize your <span class="math inline">\(4\times3\)</span> table into smaller tables and
calculate odds ratios or differences in proportions on them.</p>
<p>For example, you could compare treatment 2 and 3 with regards to the
ratio of flat and round cells. For this, you <strong>subset</strong> the
table to the relevant rows and columns:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapes_subset</span> <span class="op">&lt;-</span> <span class="va">cell_shapes</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">shapes_subset</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            round flat
treatment 2    10   29
treatment 3     1   14</code></pre>
</div>
<p>The odds for being round (vs. flat) in treatment 2 compared to
treatment 3 are:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">10</span><span class="op">/</span><span class="fl">29</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">14</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.827586</code></pre>
</div>
<p>If you are rather interested in the overall proportion of round
cells, still comparing treatment 2 and 3, you can
<strong>subset</strong> the columns and <strong>summarize</strong> some
of the rows:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">round</span> <span class="op">&lt;-</span> <span class="va">cell_shapes</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">others</span> <span class="op">&lt;-</span> <span class="va">cell_shapes</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">rowSums</span></span>
<span></span>
<span><span class="va">shapes_summary</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">round</span>,<span class="va">others</span><span class="op">)</span></span>
<span><span class="va">shapes_summary</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            round others
treatment 2    10     87
treatment 3     1     54</code></pre>
</div>
<p>Now you can compare the proportions of round cells between the
treatments 2 and 3:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">10</span><span class="op">/</span><span class="op">(</span><span class="fl">10</span><span class="op">+</span><span class="fl">87</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fl">54</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5.670103</code></pre>
</div>
<p>The proportion of round cells is 5 times higher in the experiment
with treatment 2.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You probably noticed that with larger tables, you have many more
options of sub-setting or summarizing them into <span class="math inline">\(2\times2\)</span> tables. Think carefully about
your research question and then decide which comparison you’d like to
make.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="how-to-calculate-significance">How to calculate significance?<a class="anchor" aria-label="anchor" href="#how-to-calculate-significance"></a>
</h3>
<p>As soon as you have subset or summarized your larger table into a
<span class="math inline">\(2\times2\)</span> one, you can apply the
standard Fisher or <span class="math inline">\(\chi^2\)</span> test on
it, and we’ll come back to this very soon.</p>
<p>But luckily, Fisher’s exact test and the <span class="math inline">\(\chi^2\)</span> test can also be applied to 2D
tables with more than two categories in each dimension, and this should
actually be the first step in your hypothesis testing workflow.</p>
<p>A Fisher test on the above <span class="math inline">\(3\times
4\)</span> table will answer the following question: <strong>Is there a
difference in phenotype composition between the three
treatments?</strong></p>
<p>This is an overall question and it’s controlling for the family-wise
error rate. If this test comes out significant, it tells you that under
the assumption that phenotype and treatment are not associated in any
way (i.e. for each phenotype, the underlying proportion doesn’t vary
between treatments), your results are very unlikely.</p>
<p>For the above example, the <span class="math inline">\(\chi^2\)</span> test is clearly significant:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">cell_shapes</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in chisq.test(cell_shapes): Chi-squared approximation may be incorrect</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test

data:  cell_shapes
X-squared = 62.024, df = 6, p-value = 1.744e-11</code></pre>
</div>
<p>Now you could do follow-up tests in order to find out which
phenotypes are different in their proportions between treatments, for
example:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fisher.test</span><span class="op">(</span><span class="va">shapes_summary</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Fisher's Exact Test for Count Data

data:  shapes_summary
p-value = 0.05797
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
   0.8335549 273.9339822
sample estimates:
odds ratio
  6.154128 </code></pre>
</div>
<p>Just as for calculating measures of association, you should ask
yourself what information you’re after, before running 10 or more
individual comparisons.</p>
</div>
</section><section><h2 class="section-heading" id="d-tables">3D tables<a class="anchor" aria-label="anchor" href="#d-tables"></a>
</h2>
<hr class="half-width">
<p>For higher-dimensional tables, life gets yet a bit more complicated.
Again, there are different ways of analyzing them, dependent on your
research question. We’ll look at two examples.</p>
<div class="section level3">
<h3 id="conditional-independence">Conditional independence<a class="anchor" aria-label="anchor" href="#conditional-independence"></a>
</h3>
<p>Let’s assume we have a reduced version of the above experiment, where
control and treatment are compared with respect to the number of cells
that are “round” or “not round”.</p>
<p>A resulting table might look like this:</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">round</th>
<th align="center">other</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ctrl</td>
<td align="center">16</td>
<td align="center">39</td>
</tr>
<tr class="even">
<td align="left">trt</td>
<td align="center">21</td>
<td align="center">42</td>
</tr>
</tbody>
</table>
<p>This still looks familiar. But now, the biologist at work was
concerned about the reproducibiliy of the experiment, so she performed
it twice. And as a result, we look at a 3-dimensional table:</p>
<table class="table">
<caption>replicate 1</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">round</th>
<th align="center">other</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ctrl</td>
<td align="center">16</td>
<td align="center">39</td>
</tr>
<tr class="even">
<td align="left">trt</td>
<td align="center">21</td>
<td align="center">42</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>replicate 2</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">round</th>
<th align="center">other</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ctrl</td>
<td align="center">35</td>
<td align="center">89</td>
</tr>
<tr class="even">
<td align="left">trt</td>
<td align="center">51</td>
<td align="center">99</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="how-to-create-a-3-d-table-in-r">How to create a 3-D table in R<a class="anchor" aria-label="anchor" href="#how-to-create-a-3-d-table-in-r"></a>
</h4>
<p>For analyzing this data, we need to code it up. In R, this can be
done as follows.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep1</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">16</span>, <span class="fl">39</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>,<span class="fl">42</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rep2</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">35</span>, <span class="fl">89</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">51</span>,<span class="fl">99</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">table3d</span> <span class="op">&lt;-</span> <span class="fu">array</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="va">rep1</span>, <span class="va">rep2</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">table3d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>, , 1

     [,1] [,2]
[1,]   16   39
[2,]   21   42

, , 2

     [,1] [,2]
[1,]   35   89
[2,]   51   99</code></pre>
</div>
<div id="discussion" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="discussion" class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>We could easily bring the above scenario down to a classical <span class="math inline">\(2\times2\)</span> table by pooling the counts
across replicates. What could be problematic about this approach?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The replicate might have an effect on the row and column sums. Have a
look at the Simpson’s paradox.</p>
</div>
</div>
</div>
</div>
<div id="lets-try-it" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="lets-try-it" class="callout-inner">
<h3 class="callout-title">Let’s try it</h3>
<div class="callout-content">
<p>Use the above code for creating an array and sum up the counts across
replicates.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rowSums</span><span class="op">(</span><span class="va">table3d</span>, dims<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]   51  128
[2,]   72  141</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>To avoid the danger of replicate that are confounded with a variable
of interest, one can stratify by replicate. Stratify means: split the
analysis by replicate, and then combine the results.</p>
<p>This is what the <em>Cochran-Mantel-Haenszel test</em> does. It
calculates</p>
<ul>
<li>a <em>common odds ratio</em> and</li>
<li>a modified chi-square,</li>
</ul>
<p>taking the replicates into account.</p>
</div>
</div>
</section><section><h2 class="section-heading" id="three-way-interactions">Three-way interactions<a class="anchor" aria-label="anchor" href="#three-way-interactions"></a>
</h2>
<hr class="half-width">
<p>Refer to Poisson models</p>
</section><section><h2 class="section-heading" id="additional-variance">Additional variance<a class="anchor" aria-label="anchor" href="#additional-variance"></a>
</h2>
<hr class="half-width">
<p>When we’re using Fisher’s or <span class="math inline">\(\chi^2\)</span> test, we model the data as having
been obtained from a particular sampling scheme, like Poisson, binomial
or multinomial sampling. These assume that there is an underlying rate,
or probability, at which events occur, and which doesn’t vary. For
example, we could say that patients show up at a hospital at an average
rate of 16 patients per day (<span class="math inline">\(\lambda=16\)</span>), and if we took 5 samples at
5 different days, we’d assume the same Poisson rate for each day. The
counts would vary from day to day, but with a variance of <span class="math inline">\(var=\lambda\)</span>, which is the expected
randomness for a Poisson counting process. See also <a href="https://sarahkaspar.github.io/biostatistics-course/05-Poisson.html" class="external-link">the
lesson on distributions</a>.</p>
<p>The problem is, that in biology, we often have experiments where we
deal with additional variance that can’t be explained by the normal
variance that’s inherent to Poisson counting. For example, if we model
read counts from RNA sequencing, it turns out that the (residual)
variance is much higher than <span class="math inline">\(\lambda\)</span>, because the expression of a
particular gene usually depends on more factors than just the
experimentally controlled condition(s). It is also influenced by
additional biological and possibly technical variance, such that the
counts vary considerably between replicates.</p>
<div class="section level3">
<h3 id="so-what">So what?<a class="anchor" aria-label="anchor" href="#so-what"></a>
</h3>
<p>What happens if we still analyze these data with methods that assume
Poisson variance? This increases the risk for false positives.
Intuitively speaking, the increased variance can produce high counts in
one or more of the cells, leading to higher proportions than would be
expected by change under the assumption of independence and Poisson
sampling. So the Fisher test can mistake noise for a difference in
proportions.</p>
</div>
<div class="section level3">
<h3 id="what-to-do">What to do?<a class="anchor" aria-label="anchor" href="#what-to-do"></a>
</h3>
<p>First of all, think about the data that you’re looking at, and how
they were produced. If you have several replicates, you have a chance to
estimate the variance in your data. In a typical <span class="math inline">\(2\times2\)</span> table, you just have one count
per cell, and a different condition in each cell, so there is no chance
to infer the variance from looking at the data. In this case you have to
ask yourself, whether it’s likely that you’re overlooking additional
variance, and be aware that the data might not perfectly match the
assumptions of your test, so don’t over-interpret the p-value that you
get – which is always a good advice.</p>
<p>If you do have several counts per condition, you can consider to
model your data using a generalized linear model of the negative
binomial family. This is outside the scope of this lesson.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:sarah.kaspar@embl.de">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "statistics, data, lesson, software",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/aio.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/aio.html",
  "dateCreated": "2025-03-03",
  "dateModified": "2025-03-04",
  "datePublished": "2025-03-04"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

