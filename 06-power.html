<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Analyzing Categorical Data in R: Categorical data and statistical power</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/06-power.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Analyzing Categorical Data in R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Analyzing Categorical Data in R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Analyzing Categorical Data in R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 75%" class="percentage">
    75%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 75%" aria-valuenow="75" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/06-power.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction to Categorical Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-effect-size.html">2. Quantifying association</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-visualization.html">3. Visualizing categorical data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-distributions.html">4. Sampling schemes and probabilities</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-chisquare-test.html">5. The Chi-Square test</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Categorical data and statistical power
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#statistical-power">Statistical power</a></li>
<li><a href="#the-fisher-test">The Fisher test</a></li>
<li><a href="#significance-for-discrete-data">Significance for discrete data</a></li>
<li><a href="#now-what">Now what?</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-biology.html">7. Complications with biological data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-chisquare-test.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-biology.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-chisquare-test.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: The Chi-Square test
        </a>
        <a class="chapter-link float-end" href="07-biology.html" rel="next">
          Next: Complications with... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Categorical data and statistical power</h1>
        <p> Last updated on 2023-09-08 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-power.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What determines the power of a chi-square test?</li>
<li>Why is it difficult to determine significance for discrete
data?</li>
<li>What is the Fisher test and when should I use it?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Introduce Fisher’s exact test.</li>
<li>Explain difficulties with significance testing for discrete
p-values.</li>
<li>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="statistical-power"><h2 class="section-heading">Statistical power<a class="anchor" aria-label="anchor" href="#statistical-power"></a>
</h2>
<hr class="half-width"><p>Statistical power is the probability that an effect is detected as
significant with a given method, provided that the effect really
exists.</p>
<p>In the lesson on hypothesis testing, we learned that the power
depends on</p>
<ul><li>the size of the effect,</li>
<li>the significance level,</li>
<li>the method we choose for testing, and</li>
<li>the sample size.</li>
</ul><p>In this lesson’s example, the estimated association is not quite
small (<span class="math inline">\(6\%\)</span> difference in
proportions, or risk for disease more than twice as high for exposed
mice), the significance level was the usual <span class="math inline">\(5\%\)</span>, and a sample size of 200 doesn’t
seem small, either. Still, the effect is not significant. Does this mean
that the Chi-square test is useless?</p>
<p>They key here is the low overall probability of mice contracting the
disease. Even though there were 200 mice, only a total of 14 out of them
actually contracted the disease. And it’s this low number of cases that
limits the power of the study.</p>
<p>In fact, if there was a sample of 2000 mice, and only 14 of them
caught the disease, then the p-value would hardly change:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">996</span><span class="op">)</span>,</span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">990</span><span class="op">)</span><span class="op">)</span>,</span>
<span>correct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test

data:  rbind(c(4, 996), c(10, 990))
X-squared = 2.5896, df = 1, p-value = 0.1076</code></pre>
</div>
<p>Intuitively, we still have 14 cases, and the question is how we’d
expect them to distribute among the two groups (exposure and no
exposure) by chance.</p>
<p>Thus, the power of the study is limited by the lowest counts in the
table. We could also say that extreme frequencies (a low probability of
one outcome always corresponds to a high probability of the other
outcome) are unfavorable. To overcome the problem of a low number of
cases, clinical studies are often conducted as <strong>case-control
studies</strong>. In those, the same number of cases and controls are
sampled by design. One can then compare the occurrence of certain risk
factors (e.g. smoking, exposure, …) between the two groups.</p>
</section><section id="the-fisher-test"><h2 class="section-heading">The Fisher test<a class="anchor" aria-label="anchor" href="#the-fisher-test"></a>
</h2>
<hr class="half-width"><p>There is another test, called <strong>Fisher test</strong>, which is
also used on contingency tables, and which tests exactly the same
hypothesis as the chi-square test. It doesn’t sum up the differences
between observed and expected counts, but instead calculates the
probability of the observed data using a hypergeometric distribution.
The hypergeometric distribution is similar to the multinomial
distribution (except that it assumes draws <em>without</em> replacement)
and gives exact probabilities for counts to fall into different
categories (in this case the cells) under the assumption of
independence.</p>
<p>If you do your research on which test to use (e.g. ask google),
you’ll stumble upon statements like “the Fisher test is more
conservative”, or “the <span class="math inline">\(\chi^2\)</span>-test
overestimates significance for small counts”. What does this mean?</p>
</section><section id="significance-for-discrete-data"><h2 class="section-heading">Significance for discrete data<a class="anchor" aria-label="anchor" href="#significance-for-discrete-data"></a>
</h2>
<hr class="half-width"><p>Let’s recap what it means to choose a significance level of <span class="math inline">\(\alpha=5\%\)</span>: It means we decide to reject
the null hypothesis if the probability of seeing the observed data under
the null is <span class="math inline">\(\leq5\%\)</span>.</p>
<p>For continuous probability distributions like the t-distribution used
in the t-test, this means that the probability of getting a p-value
<span class="math inline">\(&lt;0.05\)</span> is <span class="math inline">\(5\%\)</span>, the probability of getting a p-value
<span class="math inline">\(&lt;0.1\)</span> is <span class="math inline">\(10\%\)</span>, and so on.</p>
<p>Unfortunately, for discrete data, this is not actually the case.</p>
<p>The following simulation is an attempt to demonstrate this. Suppose
we test the association between the preferred animal of a person (we
give the choice between cat and dog), and their handedness. And let’s
say that being left-handed gives absolutely no information on whether a
person likes cats more than dogs, i.e. the null hypothesis of
independence is true. Further, we assume that the probability of being
left-handed is <span class="math inline">\(P(L)=0.1\)</span> and the
probability of preferring cats is <span class="math inline">\(P(C)=0.6\)</span>. The hypothetical experiment
will sample 50 left-handed and 50 right-handed persons, and ask them
about their preference for cats or dogs. With this information, we can
simulate such a study using <code>rbinom</code> for generating random
binomial numbers:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">cats_l</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">dogs_l</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_l</span></span>
<span><span class="va">cats_r</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">dogs_r</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_r</span></span>
<span></span>
<span><span class="va">simtable</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="va">cats_l</span>, <span class="va">dogs_l</span><span class="op">)</span>,</span>
<span>                  <span class="fu">c</span><span class="op">(</span><span class="va">cats_r</span>, <span class="va">dogs_r</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can also compute the p-value from this table:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">simtable</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Pearson's Chi-squared test with Yates' continuity correction

data:  simtable
X-squared = 0.35651, df = 1, p-value = 0.5505</code></pre>
</div>
<p>To see how the p-values behave, let’s run 2000 such simulations and
report the p-value. For this, I use a for-loop around the above code. In
each iteration of the loop, a contingency table under always the same
assumptions is generated, and the p-value is stored in a variable calle
<code>p_vals</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">N</span><span class="op">=</span><span class="fl">2000</span></span>
<span><span class="va">p_vals</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># as many iterations as p_vals is long</span></span>
<span>  <span class="va">cats_l</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="va">dogs_l</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_l</span></span>
<span>  <span class="va">cats_r</span> <span class="op">&lt;-</span> <span class="fu">rbinom</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="va">n</span>,prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="va">dogs_r</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">-</span><span class="va">cats_r</span></span>
<span>  </span>
<span>  <span class="va">p_vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">chisq.test</span><span class="op">(</span><span class="fu">rbind</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="va">cats_l</span>, <span class="va">dogs_l</span><span class="op">)</span>,</span>
<span>                    <span class="fu">c</span><span class="op">(</span><span class="va">cats_r</span>, <span class="va">dogs_r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>As a result of the simulation, <code>p_vals</code> contains 2000
p-values under the assumption that the null hypothesis is true.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<p>What percentage of the p-values is smaller than <span class="math inline">\(0.05\)</span>?</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">p_vals</span><span class="op">&lt;</span><span class="fl">0.05</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.004515805</code></pre>
</div>
<p>We can also make a histogram of all the p-values in the
simulation:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.frame</span><span class="op">(</span><span class="va">p_vals</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">p_vals</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="fig/06-power-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure">
In theory, the histogram should show a uniform distribution (the
probability of getting a p-value <span class="math inline">\(&lt;0.05\)</span> is <span class="math inline">\(5\%\)</span>, the probability of getting a p-value
<span class="math inline">\(&lt;0.1\)</span> is <span class="math inline">\(10\%\)</span>, and so on…). But here, instead, the
p-values are <em>discrete</em>: They can only take certain values,
because there’s only a limited number of options how 25 observations can
fall into two categories (dogs/cats).</p>
<p>Since for small counts, the chances to get a p-value <span class="math inline">\(p&lt;0.05\)</span> are actually
<strong>below</strong> 5% – and this holds also for other values of
<span class="math inline">\(p\)</span> which are not exactly <span class="math inline">\(0.05\)</span> – we say that the Fisher test is
<strong>conservative</strong>. It means that interpreting the discrete
hypergeometric probabilities as continuous p-values will lead us to
overestimated p-values. This also holds true when the null hypothesis is
actually <em>false</em>, so we’re reducing our chances to run a
significant test, even if there’s something to detect.</p>
<p>For a more detailed explanation, see <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/0470114754" class="external-link">An
introduction to Categorical Data Analysis</a> by Alan Agresti.</p>
</section><section id="now-what"><h2 class="section-heading">Now what?<a class="anchor" aria-label="anchor" href="#now-what"></a>
</h2>
<hr class="half-width"><p>The Fisher test is conservative, especially for low counts. The <span class="math inline">\(\chi^2\)</span>-test doesn’t have this problem,
but at the same time should not be applied to tables with low counts,
because it might produce <em>false positives</em> (see the <a href="05-chisquare-test.html#when-to-apply">rule of thumb</a>). So what
should we do? There is not one commonly accepted answer to this. Some
suggestions are:</p>
<ul><li>Use Fisher’s exact test and accept that it can be conservative. In
the end, low counts indicate a small amount of evidence anyways, and you
might need to collect more data to detect or confirm an effect.</li>
<li>In <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/0470114754" class="external-link">Agresti’s
book</a>, you’ll find mid p-values and similar methods that aim at
correcting the p-value for its discreteness.</li>
<li>You can use the <span class="math inline">\(\chi^2\)</span>-test in
conjunction with <a href="https://en.wikipedia.org/wiki/Yates%27s_correction_for_continuity" class="external-link">Yates
continuity correction</a>. It applies a correction on the <span class="math inline">\(\chi^2\)</span> statistic for tables with low
expected counts to avoid underestimating the p-value. This method is not
perfect either, and can lead to over-correcting.</li>
</ul><p>The important part is that you don’t choose the method based on the
p-value it produces for your specific data set. The worst thing you can
do is try 3 different methods, choose the one with the lowest p-value
and report this one. This is a form of p-value hacking called <em>method
hacking</em> and increases your chances to produce false positive
results. If your test comes out significant in only one of the tests you
tried, be honest and report all of them, or otherwise investigate
further, for example by collecting more data.</p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-chisquare-test.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-biology.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-chisquare-test.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: The Chi-Square test
        </a>
        <a class="chapter-link float-end" href="07-biology.html" rel="next">
          Next: Complications with... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-power.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:sarah.kaspar@embl.de">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.13.0" class="external-link">sandpaper (0.13.0)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.6.1" class="external-link">pegboard (0.6.1)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.3.0" class="external-link">varnish (0.3.0)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/06-power.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "statistics, data, lesson, software",
  "name": "Categorical data and statistical power",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/06-power.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/06-power.html",
  "dateCreated": "2023-09-08",
  "dateModified": "2023-09-08",
  "datePublished": "2023-09-19"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

